<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BNO08x Firmware: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.title = "Change Theme"
    DoxygenAwesomeDarkModeToggle.lightModeIcon = 'ðŸŒž'
    DoxygenAwesomeDarkModeToggle.darkModeIcon = `<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#009793"><g><rect fill="none" height="24" width="24"/></g><g><g><path d="M8.1,14.15C9.77,14.63,11,16.17,11,18c0,0.68-0.19,1.31-0.48,1.87c0.48,0.09,0.97,0.14,1.48,0.14 c1.48,0,2.9-0.41,4.13-1.15c-2.62-0.92-5.23-2.82-6.8-5.86C7.74,9.94,7.78,7.09,8.29,4.9c-2.57,1.33-4.3,4.01-4.3,7.1c0,0,0,0,0,0 c0.01,0,0.01,0,0.02,0C5.66,12,7.18,12.83,8.1,14.15z" opacity=".3"/><path d="M19.78,17.51c-2.47,0-6.57-1.33-8.68-5.43C8.77,7.57,10.6,3.6,11.63,2.01C6.27,2.2,1.98,6.59,1.98,12 c0,0.14,0.02,0.28,0.02,0.42C2.61,12.16,3.28,12,3.98,12c0,0,0,0,0,0c0-3.09,1.73-5.77,4.3-7.1C7.78,7.09,7.74,9.94,9.32,13 c1.57,3.04,4.18,4.95,6.8,5.86c-1.23,0.74-2.65,1.15-4.13,1.15c-0.5,0-1-0.05-1.48-0.14c-0.37,0.7-0.94,1.27-1.64,1.64 c0.98,0.32,2.03,0.5,3.11,0.5c3.5,0,6.58-1.8,8.37-4.52C20.18,17.5,19.98,17.51,19.78,17.51z"/><path d="M7,16l-0.18,0C6.4,14.84,5.3,14,4,14c-1.66,0-3,1.34-3,3s1.34,3,3,3c0.62,0,2.49,0,3,0c1.1,0,2-0.9,2-2 C9,16.9,8.1,16,7,16z"/></g></g></svg>`
    DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BNO08x Firmware
   </div>
   <div id="projectbrief">Firmware to interface with a BNO08x sensor</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('gs.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Getting Started </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In order to use the library, several functions must be declared before use. These are the I2C functions found in the <a class="el" href="structi2c__interface.html">i2c_interface</a>. The <code>initialise</code> function must also be run before any communication takes place.</p>
<p>A <code>MAX_PAYLOAD_SIZE</code> value must also be defined.</p>
<p>Before sensors can be read, the sensor must be enabled (found in <a class="el" href="sensors_8h.html">sensors.h</a>).</p>
<p>An minimal example for a Raspberry Pi Pico can be see below.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;boards/pico.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;hardware/gpio.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;hardware/timer.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pico/platform.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pico/stdio.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pico/stdlib.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;hardware/i2c.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bno08x_8h.html">bno08x.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;defs.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="i2c_8h.html">i2c.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="logger_8h.html">logger.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="output_8h.html">output.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define FREQ_HZ     400000u</span></div>
<div class="line"><span class="preprocessor">#define I2C_INST    i2c0</span></div>
<div class="line"><span class="preprocessor">#define SDA_PIN     16</span></div>
<div class="line"><span class="preprocessor">#define SCL_PIN     17</span></div>
<div class="line"><span class="preprocessor">#define TIMEOUT_MS  5000</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SENSOR_REPORT_RATE 50</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the callback for writing data to the I2C bus</span></div>
<div class="line"><span class="keyword">enum</span> <a class="code hl_enumeration" href="i2c_8h.html#a1be58a16c8c5ada6066b62182cdb3540">I2C_RESPONSE</a> write_i2c(<span class="keyword">const</span> uint8_t addr, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code hl_struct" href="structi2c__message.html">i2c_message</a>* message){</div>
<div class="line">    info(<span class="stringliteral">&quot;Writing %d bytes\n&quot;</span>, message-&gt;<a class="code hl_variable" href="structi2c__message.html#ab2b3adeb2a67e656ff030b56727fd0ac">length</a>);</div>
<div class="line">    int8_t res = i2c_write_blocking_until(I2C_INST, addr, message-&gt;<a class="code hl_variable" href="structi2c__message.html#a1677d80e48189228cc0c188e9f78e57e">payload</a>, message-&gt;<a class="code hl_variable" href="structi2c__message.html#ab2b3adeb2a67e656ff030b56727fd0ac">length</a>, <span class="keyword">false</span>, (absolute_time_t) {(time_us_64() + (TIMEOUT_MS * 1000))});</div>
<div class="line">    <span class="keywordflow">if</span>(res == PICO_ERROR_GENERIC || res == PICO_ERROR_TIMEOUT){</div>
<div class="line">        <span class="keywordflow">return</span> ERROR_GENERIC;</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">return</span> SUCCESS;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the callback for reading data from the I2C bus</span></div>
<div class="line"><span class="keyword">enum</span> <a class="code hl_enumeration" href="i2c_8h.html#a1be58a16c8c5ada6066b62182cdb3540">I2C_RESPONSE</a> read_i2c(<span class="keyword">const</span> uint8_t addr, <span class="keyword">struct</span> <a class="code hl_struct" href="structi2c__message.html">i2c_message</a>* message, <span class="keyword">const</span> uint16_t n){</div>
<div class="line">    uint8_t buf[n];</div>
<div class="line"> </div>
<div class="line">    int8_t res = i2c_read_blocking_until(I2C_INST, addr, buf, n, <span class="keyword">false</span>, (absolute_time_t) {(time_us_64() + (TIMEOUT_MS * 1000))});</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>(res == PICO_ERROR_GENERIC || res == PICO_ERROR_TIMEOUT){</div>
<div class="line">    <span class="keywordflow">return</span> ERROR_GENERIC;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    memcpy(message-&gt;<a class="code hl_variable" href="structi2c__message.html#a1677d80e48189228cc0c188e9f78e57e">payload</a>, buf, n);</div>
<div class="line">        message-&gt;<a class="code hl_variable" href="structi2c__message.html#ab2b3adeb2a67e656ff030b56727fd0ac">length</a> = n;</div>
<div class="line">        <span class="keywordflow">return</span> SUCCESS;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the callback to initialise the I2C interface</span></div>
<div class="line"><span class="keyword">enum</span> <a class="code hl_enumeration" href="i2c_8h.html#a1be58a16c8c5ada6066b62182cdb3540">I2C_RESPONSE</a> init_i2c(<span class="keyword">struct</span> <a class="code hl_struct" href="structi2c__interface.html">i2c_interface</a>* self){</div>
<div class="line">    i2c_init(I2C_INST, FREQ_HZ);</div>
<div class="line"> </div>
<div class="line">  gpio_set_function(SDA_PIN, GPIO_FUNC_I2C);</div>
<div class="line">  gpio_set_function(SCL_PIN, GPIO_FUNC_I2C);</div>
<div class="line"> </div>
<div class="line">  gpio_pull_up(SCL_PIN);</div>
<div class="line">  gpio_pull_up(SDA_PIN);</div>
<div class="line"> </div>
<div class="line">    self-&gt;<a class="code hl_variable" href="structi2c__interface.html#ad86e7ae1ce88f3a7655a02558318afc3">initialised</a> = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">  info(<span class="stringliteral">&quot;I2C interface successfully configured\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> SUCCESS;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line"> </div>
<div class="line">    stdio_init_all();</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\n***\n\n&quot;</span>);</div>
<div class="line">    info(<span class="stringliteral">&quot;Starting initialisation process\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    info(<span class="stringliteral">&quot;Initialising data structures\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="structi2c__interface.html">i2c_interface</a>* i2c = &amp;(<span class="keyword">struct </span><a class="code hl_struct" href="structi2c__interface.html">i2c_interface</a>) {</div>
<div class="line">        .<a class="code hl_variable" href="structi2c__interface.html#acb49865e2894e64fdb1749089ea4ecfe">sda_pin</a> = SDA_PIN,</div>
<div class="line">        .scl_pin = SCL_PIN,</div>
<div class="line">        .baud_rate_hz = FREQ_HZ,</div>
<div class="line">        .initialise = <span class="keyword">false</span>,</div>
<div class="line">        .write = &amp;write_i2c,</div>
<div class="line">        .read = &amp;read_i2c,</div>
<div class="line">        .initialise = &amp;init_i2c</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    i2c-&gt;<a class="code hl_variable" href="structi2c__interface.html#a2b029a80e90944058da87d6544294625">initialise</a>(i2c);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="structsensor__collection.html">sensor_collection</a> sc = <a class="code hl_function" href="bno08x_8h.html#ad10c299e74552cfca458c4fe60629715">init</a>(i2c);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="bno08x_8h.html#ae4bf054129673570be11d3250aa61a20">enable_sensor</a>(i2c, &amp;sc, ACCELEROMETER, SENSOR_REPORT_RATE);</div>
<div class="line">    <a class="code hl_function" href="bno08x_8h.html#ae4bf054129673570be11d3250aa61a20">enable_sensor</a>(i2c, &amp;sc, GYROSCOPE, SENSOR_REPORT_RATE);</div>
<div class="line">    <a class="code hl_function" href="bno08x_8h.html#ae4bf054129673570be11d3250aa61a20">enable_sensor</a>(i2c, &amp;sc, MAGNETIC_FIELD, SENSOR_REPORT_RATE);</div>
<div class="line"> </div>
<div class="line">    info(<span class="stringliteral">&quot;Initialisation process complete\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(;;){</div>
<div class="line">        <a class="code hl_function" href="bno08x_8h.html#afcbe1d2f332a7802f7ce27201e08d7e0">read_sensors</a>(i2c, &amp;sc);</div>
<div class="line">        sleep_ms(SENSOR_REPORT_RATE);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="abno08x_8h_html"><div class="ttname"><a href="bno08x_8h.html">bno08x.h</a></div><div class="ttdoc">Defines the top level entities for the library.</div></div>
<div class="ttc" id="abno08x_8h_html_ad10c299e74552cfca458c4fe60629715"><div class="ttname"><a href="bno08x_8h.html#ad10c299e74552cfca458c4fe60629715">init</a></div><div class="ttdeci">struct sensor_collection init(const struct i2c_interface *i2c)</div><div class="ttdoc">Turn on the sensor and open the channel.</div><div class="ttdef"><b>Definition:</b> bno08x.c:242</div></div>
<div class="ttc" id="abno08x_8h_html_ae4bf054129673570be11d3250aa61a20"><div class="ttname"><a href="bno08x_8h.html#ae4bf054129673570be11d3250aa61a20">enable_sensor</a></div><div class="ttdeci">bool enable_sensor(const struct i2c_interface *i2c, struct sensor_collection *sc, const enum REPORT_ID id, const uint32_t sample_rate_ms)</div><div class="ttdoc">Enables a specified sensor with a fixed report rate.</div><div class="ttdef"><b>Definition:</b> bno08x.c:382</div></div>
<div class="ttc" id="abno08x_8h_html_afcbe1d2f332a7802f7ce27201e08d7e0"><div class="ttname"><a href="bno08x_8h.html#afcbe1d2f332a7802f7ce27201e08d7e0">read_sensors</a></div><div class="ttdeci">bool read_sensors(const struct i2c_interface *i2c, struct sensor_collection *sc)</div><div class="ttdoc">Read the latest sensor report on the bus.</div><div class="ttdef"><b>Definition:</b> bno08x.c:432</div></div>
<div class="ttc" id="ai2c_8h_html"><div class="ttname"><a href="i2c_8h.html">i2c.h</a></div><div class="ttdoc">I2C related definitions.</div></div>
<div class="ttc" id="ai2c_8h_html_a1be58a16c8c5ada6066b62182cdb3540"><div class="ttname"><a href="i2c_8h.html#a1be58a16c8c5ada6066b62182cdb3540">I2C_RESPONSE</a></div><div class="ttdeci">I2C_RESPONSE</div><div class="ttdoc">Possible I2C response codes.</div><div class="ttdef"><b>Definition:</b> i2c.h:37</div></div>
<div class="ttc" id="alogger_8h_html"><div class="ttname"><a href="logger_8h.html">logger.h</a></div><div class="ttdoc">A very basic logger implementation.</div></div>
<div class="ttc" id="aoutput_8h_html"><div class="ttname"><a href="output_8h.html">output.h</a></div><div class="ttdoc">Functions to print data to stdout.</div></div>
<div class="ttc" id="astructi2c__interface_html"><div class="ttname"><a href="structi2c__interface.html">i2c_interface</a></div><div class="ttdoc">Holds the data relevant to the I2C interface configuration.</div><div class="ttdef"><b>Definition:</b> i2c.h:68</div></div>
<div class="ttc" id="astructi2c__interface_html_a2b029a80e90944058da87d6544294625"><div class="ttname"><a href="structi2c__interface.html#a2b029a80e90944058da87d6544294625">i2c_interface::initialise</a></div><div class="ttdeci">enum I2C_RESPONSE(* initialise)(struct i2c_interface *self)</div><div class="ttdoc">Callback to initialise the I2C interface.</div><div class="ttdef"><b>Definition:</b> i2c.h:98</div></div>
<div class="ttc" id="astructi2c__interface_html_acb49865e2894e64fdb1749089ea4ecfe"><div class="ttname"><a href="structi2c__interface.html#acb49865e2894e64fdb1749089ea4ecfe">i2c_interface::sda_pin</a></div><div class="ttdeci">uint8_t sda_pin</div><div class="ttdef"><b>Definition:</b> i2c.h:69</div></div>
<div class="ttc" id="astructi2c__interface_html_ad86e7ae1ce88f3a7655a02558318afc3"><div class="ttname"><a href="structi2c__interface.html#ad86e7ae1ce88f3a7655a02558318afc3">i2c_interface::initialised</a></div><div class="ttdeci">bool initialised</div><div class="ttdef"><b>Definition:</b> i2c.h:72</div></div>
<div class="ttc" id="astructi2c__message_html"><div class="ttname"><a href="structi2c__message.html">i2c_message</a></div><div class="ttdoc">Contains the relevant data about messages on the bus.</div><div class="ttdef"><b>Definition:</b> i2c.h:55</div></div>
<div class="ttc" id="astructi2c__message_html_a1677d80e48189228cc0c188e9f78e57e"><div class="ttname"><a href="structi2c__message.html#a1677d80e48189228cc0c188e9f78e57e">i2c_message::payload</a></div><div class="ttdeci">uint8_t payload[MAX_PAYLOAD_SIZE]</div><div class="ttdef"><b>Definition:</b> i2c.h:56</div></div>
<div class="ttc" id="astructi2c__message_html_ab2b3adeb2a67e656ff030b56727fd0ac"><div class="ttname"><a href="structi2c__message.html#ab2b3adeb2a67e656ff030b56727fd0ac">i2c_message::length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdef"><b>Definition:</b> i2c.h:57</div></div>
<div class="ttc" id="astructsensor__collection_html"><div class="ttname"><a href="structsensor__collection.html">sensor_collection</a></div><div class="ttdoc">Stores the collection of sensors.</div><div class="ttdef"><b>Definition:</b> bno08x.h:252</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
